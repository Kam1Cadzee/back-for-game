# Migration `20200601005347-unique`

This migration has been generated by Vadim Vereketa at 6/1/2020, 12:53:47 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."_EntityToPhrase" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_EntityToSentence" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

ALTER TABLE "public"."Phrase" DROP CONSTRAINT IF EXiSTS "Phrase_entityId_fkey",
DROP COLUMN "entityId";

ALTER TABLE "public"."Sentence" DROP CONSTRAINT IF EXiSTS "Sentence_entityId_fkey",
DROP COLUMN "entityId";

ALTER TABLE "public"."Translate" ALTER COLUMN "type" SET DEFAULT 'OTHER';

ALTER TABLE "public"."User" ALTER COLUMN "role" SET DEFAULT 'STANDARD';

ALTER TABLE "public"."Word" ALTER COLUMN "type" SET DEFAULT 'OTHER';

CREATE UNIQUE INDEX "_EntityToPhrase_AB_unique" ON "public"."_EntityToPhrase"("A","B")

CREATE  INDEX "_EntityToPhrase_B_index" ON "public"."_EntityToPhrase"("B")

CREATE UNIQUE INDEX "_EntityToSentence_AB_unique" ON "public"."_EntityToSentence"("A","B")

CREATE  INDEX "_EntityToSentence_B_index" ON "public"."_EntityToSentence"("B")

CREATE UNIQUE INDEX "Phrase.phrase" ON "public"."Phrase"("phrase")

CREATE UNIQUE INDEX "Sentence.sentence" ON "public"."Sentence"("sentence")

ALTER TABLE "public"."_EntityToPhrase" ADD FOREIGN KEY ("A")REFERENCES "public"."Entity"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EntityToPhrase" ADD FOREIGN KEY ("B")REFERENCES "public"."Phrase"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EntityToSentence" ADD FOREIGN KEY ("A")REFERENCES "public"."Entity"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_EntityToSentence" ADD FOREIGN KEY ("B")REFERENCES "public"."Sentence"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200531234003-multi-entities..20200601005347-unique
--- datamodel.dml
+++ datamodel.dml
@@ -8,9 +8,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model User {
   createdAt DateTime @default(now())
@@ -92,18 +92,16 @@
   updatedAt DateTime     @default(now())
 }
 model Phrase {
-  id       Int     @default(autoincrement()) @id
-  phrase   String
+  id       Int      @default(autoincrement()) @id
+  phrase   String   @unique
   ru       String
-  Entity   Entity? @relation(fields: [entityId], references: [id])
-  entityId Int?
+  entities Entity[]
 }
 model Sentence {
-  id       Int     @default(autoincrement()) @id
-  sentence String
+  id       Int      @default(autoincrement()) @id
+  sentence String   @unique
   ru       String
-  Entity   Entity? @relation(fields: [entityId], references: [id])
-  entityId Int?
+  entities Entity[]
 }
```


